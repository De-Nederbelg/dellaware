/* app-fixed.js ‚Äî bundled fixed app */

// The real, working JS is large; for this ZIP we'll inline the same logic compactly:
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
import { getFirestore, collection, doc, addDoc, getDocs, deleteDoc, updateDoc, onSnapshot, serverTimestamp, enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";
const firebaseConfig = {apiKey:"AIzaSyDp51JxwZVSENlKIG_DPEns4Y9iQrwYrBw",authDomain:"delaware05-5cb47.firebaseapp.com",projectId:"delaware05-5cb47",storageBucket:"delaware05-5cb47.firebasestorage.app",messagingSenderId:"736835481813",appId:"1:736835481813:web:af62f316e2712ce39a725c",measurementId:"G-KFJGYZ428B"};
const $=(s)=>document.querySelector(s), $$=(s)=>Array.from(document.querySelectorAll(s));
const banner=$('#offline-banner'), tabs=$('#tabs'), rolePicker=$('#role-picker'), who=$('#whoami');
const state={mode:'cloud',meRole:'employee',plants:[],teams:[],employees:[],tasks:[],notifications:[],absences:[],holidays:[]};
let app,db;async function initFirebase(){app=initializeApp(firebaseConfig);db=getFirestore(app);try{await enableIndexedDbPersistence(db)}catch{}}
const Local=(()=>{const KEY='planning_local_v51',read=()=>{try{return JSON.parse(localStorage.getItem(KEY))||{}}catch{return{}}},write=(d)=>localStorage.setItem(KEY,JSON.stringify(d));let db=Object.assign({plants:[],teams:[],employees:[],tasks:[],notifications:[],absences:[],holidays:[]},read());const uid=()=>'loc_'+Math.random().toString(36).slice(2,10),now=()=>({seconds:Math.floor(Date.now()/1000)});if(!db.plants.length){const p1={id:uid(),name:'Plant A',location:'Gent, BE',lat:51.05,lng:3.73,capacity:120,status:'actief'},team={id:uid(),name:'Team Alpha',supervisorId:null},e1={id:uid(),firstName:'Sara',lastName:'De Vos',role:'employee',teamId:team.id,plantId:p1.id,status:'active',email:'employee@demo.com'},e2={id:uid(),firstName:'Tom',lastName:'Peeters',role:'supervisor',teamId:team.id,plantId:p1.id,status:'active',email:'supervisor@demo.com'},t1={id:uid(),name:'Inspectie lijn 2',plantId:p1.id,teamId:team.id,employeeId:e1.id,duration:2,date:null,status:'open',createdAt:now()};db={...db,plants:[p1],teams:[team],employees:[e1,e2],tasks:[t1],notifications:[],absences:[],holidays:[]};write(db)}function save(){write(db)}function list(c){return Promise.resolve(db[c].map(x=>({...x})))}function create(c,item){const id=uid();const rec={id,...item};if(c==='tasks'||c==='notifications'||c==='holidays')rec.createdAt=now();db[c].push(rec);save();return Promise.resolve({id})}function update(c,id,patch){const i=db[c].findIndex(x=>x.id===id);if(i>-1){db[c][i]={...db[c][i],...patch};save()}return Promise.resolve()}function remove(c,id){db[c]=db[c].filter(x=>x.id!==id);save();return Promise.resolve()}function subscribe(c,cb){cb(db[c].map(x=>({...x})));return ()=>{}}return{list,create,update,delete:remove,subscribe}})();
const Cloud=(()=>({async tryConnect(){try{await initFirebase();await getDocs(collection(db,'plants'));return true}catch(e){console.warn('Firestore connect fail',e);return false}},subscribe(c,cb){return onSnapshot(collection(db,c),(snap)=>cb(snap.docs.map(d=>({id:d.id,...d.data()}))))},list(c){return getDocs(collection(db,c)).then(s=>s.docs.map(d=>({id:d.id,...d.data()})))},async create(c,data){if(c==='tasks'||c==='notifications'||c==='holidays')data.createdAt=serverTimestamp();const ref=await addDoc(collection(db,c),data);return{id:ref.id}},update(c,id,data){return updateDoc(doc(db,c,id),data)},delete(c,id){return deleteDoc(doc(db,c,id))}}))();
const data={_backend:Cloud,async tryCloud(){const ok=await Cloud.tryConnect();if(!ok)throw new Error('cloud-unavailable');this._backend=Cloud;state.mode='cloud'},useLocal(){this._backend=Local;state.mode='local';banner.style.display='none';bootSubscriptions()},subscribe(c,cb){return this._backend.subscribe(c,cb)},list(c){return this._backend.list(c)},create(c,p){return this._backend.create(c,p)},update(c,id,p){return this._backend.update(c,id,p)},delete(c,id){return this._backend.delete(c,id)},tasks:{create:(p)=>data.create('tasks',p),update:(id,p)=>data.update('tasks',id,p),delete:(id)=>data.delete('tasks',id)},plants:{create:(p)=>data.create('plants',p),update:(id,p)=>data.update('plants',id,p),delete:(id)=>data.delete('plants',id)},employees:{create:(p)=>data.create('employees',p),update:(id,p)=>data.update('employees',id,p)},notifications:{create:(p)=>data.create('notifications',p),delete:(id)=>data.delete('notifications',id)},teams:{create:(p)=>data.create('teams',p),update:(id,p)=>data.update('teams',id,p)},absences:{create:(p)=>data.create('absences',p),delete:(id)=>data.delete('absences',id)},holidays:{create:(p)=>data.create('holidays',p),update:(id,p)=>data.update('holidays',id,p)}};window.data=data;
function applyRoleGates(){const role=state.meRole||'employee';$$('#tabs [data-role]').forEach(btn=>{const allowed=btn.dataset.role.split(' ').includes(role);btn.style.display=allowed?'inline-flex':'none'});$$('[data-role]').forEach(el=>{const allowed=el.dataset.role.split(' ').includes(role);el.classList.toggle('disabled',!allowed)});who.textContent=`ingelogd als: ${role}`;(role==='manager'||role==='supervisor')?switchTab('dashboard'):switchTab('my')}rolePicker.addEventListener('change',()=>{state.meRole=rolePicker.value;applyRoleGates();renderBoard();renderMy()});
function requireRole(r){if(state.meRole!==r){alert(`Niet toegestaan (rol vereist: ${r})`);throw new Error('forbidden')}}function requireAny(...rs){if(!rs.includes(state.meRole)){alert(`Niet toegestaan (rollen: ${rs.join(', ')})`);throw new Error('forbidden')}}function switchTab(key){$$('#tabs button').forEach(b=>b.classList.toggle('active',b.dataset.tab===key));$$('#tab-dashboard,#tab-planning,#tab-tasks,#tab-teams,#tab-map,#tab-notifications,#tab-my').forEach(s=>s.classList.add('hide'));const sec=document.getElementById('tab-'+key);if(sec)sec.classList.remove('hide');if(key==='planning')renderBoard();if(key==='my')renderMy();if(key==='teams')renderTeams();if(key==='map')renderMap();if(key==='tasks')renderTasks()}tabs.addEventListener('click',e=>{const b=e.target.closest('button[data-tab]');if(!b)return;switchTab(b.dataset.tab)});
const ui={open(html,title='Bewerken',onOk=null){const modal=$('#modal');$('#modal-title').textContent=title;$('#modal-body').innerHTML=html;modal.returnValue='';modal.showModal();if(onOk){const h=()=>{if(modal.returnValue!=='cancel')onOk();modal.removeEventListener('close',h)};modal.addEventListener('close',h)}},openCreateTask(){requireRole('manager');const html=`<div class="row"><div><label>Naam</label><input id="t-name" placeholder="bv. Onderhoud lijn 3"/></div><div><label>Duur (uren)</label><input id="t-dur" type="number" min="0" step="0.5" value="1"/></div></div><div class="row"><div><label>Plant</label><select id="t-plant"></select></div><div><label>Team</label><select id="t-team"></select></div></div><div class="row"><div><label>Teamlid (optioneel)</label><select id="t-emp"><option value="">‚Äî</option></select></div><div><label>Datum</label><input id="t-date" type="date"/></div></div><div><label>Status</label><select id="t-status"><option value="open">Open</option><option value="in_progress">In uitvoering</option><option value="done">Afgerond</option></select></div>`;ui.open(html,'Nieuwe taak',async()=>{const name=$('#t-name').value.trim();const duration=parseFloat($('#t-dur').value)||0;const plantId=$('#t-plant').value;const teamId=$('#t-team').value||null;const employeeId=$('#t-emp').value||null;const date=$('#t-date').value||null;const status=$('#t-status').value;if(!name||!plantId)return;await data.tasks.create({name,duration,plantId,teamId,employeeId,date,status});if(employeeId){await notifyUpdate(employeeId,`Nieuwe taak toegewezen: ${name}`)}});fillOptions('plants','#t-plant');fillTeamOptions('#t-team');fillOptions('employees','#t-emp',e=>`${e.firstName} ${e.lastName}`)}};window.ui=ui;
function labelStatus(s){return s==='open'?'Open':s==='in_progress'?'In uitvoering':'Afgerond'}async function removeTask(id){requireRole('manager');if(confirm('Taak verwijderen?'))await data.tasks.delete(id)}function editTask(id){requireAny('manager','supervisor');const t=state.tasks.find(x=>x.id===id);if(!t)return;const html=`<div class="row"><div><label>Naam</label><input id="et-name" value="${t.name||''}"/></div><div><label>Duur (uren)</label><input id="et-dur" type="number" min="0" step="0.5" value="${t.duration||0}"/></div></div><div class="row"><div><label>Status</label><select id="et-status"><option value="open">Open</option><option value="in_progress">In uitvoering</option><option value="done">Afgerond</option></select></div><div><label>Datum</label><input id="et-date" type="date" value="${t.date||''}"/></div></div>`;ui.open(html,'Taak bewerken',async()=>{await data.tasks.update(id,{name:$('#et-name').value,duration:parseFloat($('#et-dur').value)||0,status:$('#et-status').value,date:$('#et-date').value||null})});setTimeout(()=>{$('#et-status').value=t.status||'open'},0)}async function assignTask(id){requireRole('manager');const t=state.tasks.find(x=>x.id===id);if(!t)return;const html=`<div class="row"><div><label>Team</label><select id="as-team"></select></div><div><label>Teamlid</label><select id="as-emp"></select></div></div><div><label>Datum</label><input id="as-date" type="date" value="${t.date||''}"/></div>`;ui.open(html,'Taak toewijzen',async()=>{const teamId=$('#as-team').value||null;const employeeId=$('#as-emp').value||null;const date=$('#as-date').value||null;await data.tasks.update(id,{teamId,employeeId,date});if(employeeId){await notifyUpdate(employeeId,`Taak toegewezen: ${t.name}`)}});fillTeamOptions('#as-team',t.teamId);fillOptions('employees','#as-emp',(e)=>`${e.firstName} ${e.lastName}`,t.employeeId||'')}window.removeTask=removeTask;window.editTask=editTask;window.assignTask=assignTask;
function updateKPIs(){const open=state.tasks.filter(t=>t.status==='open').length,prog=state.tasks.filter(t=>t.status==='in_progress').length,done=state.tasks.filter(t=>t.status==='done').length,sick=state.employees.filter(e=>e.status==='sick').length;$('#kpi-open').textContent=open;$('#kpi-inprogress').textContent=prog;$('#kpi-done').textContent=done;$('#kpi-sick').textContent=sick;drawMonthChart()}
function renderTasks(){const teamId=$('#task-team')?.value||'',st=$('#task-status')?.value||'',date=$('#task-date')?.value||'',tbody=$('#task-rows');if(!tbody)return;tbody.innerHTML='';const rows=state.tasks.filter(t=>{if(teamId&&t.teamId!==teamId)return false;if(st&&t.status!==st)return false;if(date&&t.date!==date)return false;return true}).map(t=>{const plant=state.plants.find(p=>p.id===t.plantId),emp=state.employees.find(e=>e.id===t.employeeId),team=state.teams.find(g=>g.id===t.teamId);return `<tr><td>${t.name||'-'}</td><td>${plant?.name||'-'}</td><td>${team?.name||'‚Äî'}</td><td>${emp?`${emp.firstName} ${emp.lastName}`:'‚Äî'}</td><td>${t.duration||0}</td><td>${t.date||'‚Äî'}</td><td><span class="tag">${labelStatus(t.status)}</span></td><td class="actions"><button class="btn" onclick='assignTask("${t.id}")' data-role="manager">Toewijzen</button><button class="btn" onclick='editTask("${t.id}")' data-role="manager supervisor">Bewerken</button><button class="btn" onclick='removeTask("${t.id}")' data-role="manager">Verwijderen</button></td></tr>`}).join('');tbody.innerHTML=rows||`<tr><td colspan="8" class="muted">Geen taken gevonden.</td></tr>`;updateKPIs()}
function renderTeams(){const host=$('#team-list');if(!host)return;host.innerHTML='';state.teams.forEach(team=>{const supervisor=state.employees.find(e=>e.id===team.supervisorId),members=state.employees.filter(e=>e.teamId===team.id);const div=document.createElement('div');div.className='panel';div.innerHTML=`<h2>${team.name}</h2><div class="content"><div class="row"><div><span class="muted">Supervisor</span><div>${supervisor?supervisor.firstName+' '+supervisor.lastName:'‚Äî'}</div></div><div><span class="muted">Leden</span><div>${members.map(m=>m.firstName+' '+m.lastName).join(', ')||'‚Äî'}</div></div></div><div class="actions" style="margin-top:12px"><button class="btn" onclick='assignToTeam("${team.id}")' data-role="manager">Lid toevoegen</button></div></div>`;host.appendChild(div)});if(!state.teams.length){host.innerHTML=`<div class="muted">Nog geen teams‚Ä¶ Voeg er √©√©n toe.</div>`}}function assignToTeam(teamId){const t=state.teams.find(x=>x.id===teamId);ui.openAssignToTeam?ui.openAssignToTeam(t):alert('Teamlid toevoegen via PoC modal.')}window.assignToTeam=assignToTeam;
function renderBoard(){const teamSel=$('#board-team'),dateSel=$('#board-date');if(teamSel&&!teamSel.value&&state.teams[0])teamSel.value=state.teams[0].id;const teamId=teamSel?.value||null,date=dateSel?.value||null,unassignedHost=$('#board-unassigned'),assignedHost=$('#board-assigned');if(!unassignedHost||!assignedHost)return;unassignedHost.innerHTML='';assignedHost.innerHTML='';const unassigned=state.tasks.filter(t=>!t.employeeId&&(!teamId||t.teamId===teamId)),assigned=state.tasks.filter(t=>t.employeeId&&(!teamId||t.teamId===teamId)&&(!date||t.date===date));unassigned.forEach(t=>unassignedHost.appendChild(taskCard(t,true)));assigned.forEach(t=>assignedHost.appendChild(taskCard(t,false)))}function taskCard(t,canAssign){const div=document.createElement('div');div.className='task-card';const emp=state.employees.find(e=>e.id===t.employeeId);div.innerHTML=`<b>${t.name}</b><div class="meta">duur: ${t.duration||0}u ‚Ä¢ datum: ${t.date||'‚Äî'} ‚Ä¢ ${emp?'toegewezen aan: '+emp.firstName+' '+emp.lastName:'niet toegewezen'}</div><div class="actions" style="margin-top:8px">${canAssign?`<button class="btn" onclick='assignTask("${t.id}")' data-role="manager">Toewijzen</button>`:''}<button class="btn" onclick='editTask("${t.id}")' data-role="manager supervisor">Bewerken</button></div>`;return div}
function renderMy(){const container=$('#my-planning'),abs=$('#my-absences');if(!container)return;let tasks=[];if(state.meRole==='supervisor'){const teamId=state.teams[0]?.id;tasks=state.tasks.filter(t=>t.teamId===teamId)}else if(state.meRole==='manager'){tasks=[]}else{const myId=state.employees[0]?.id;tasks=state.tasks.filter(t=>t.employeeId===myId)}container.innerHTML=tasks.map(t=>`<div class="task-card"><b>${t.name}</b><div class="meta">${t.date||'‚Äî'} ‚Ä¢ ${labelStatus(t.status)} ‚Ä¢ ${t.duration||0}u</div></div>`).join('')||'<div class="muted">Geen taken.</div>';abs.innerHTML=renderMyAbsences()}function renderMyAbsences(){const myId=state.employees[0]?.id,myIll=state.absences.filter(a=>a.employeeId===myId),myHol=state.holidays.filter(h=>h.employeeId===myId),illRows=myIll.map(a=>`<div>ü§í ${a.from} ‚Üí ${a.to}</div>`).join(''),holRows=myHol.map(h=>`<div>üèñÔ∏è ${h.from} ‚Üí ${h.to} <span class="badge">${h.status}</span></div>`).join('');return(illRows+holRows)||'<div class="muted">Geen afwezigheden.</div>'}
function fillOptions(col,sel,mapFn=null,selected=null){const el=document.querySelector(sel);if(!el)return;el.innerHTML='';(state[col]||[]).forEach(d=>{const o=document.createElement('option');o.value=d.id;o.textContent=mapFn?mapFn(d):(d.name||d.id);if(selected&&selected===d.id)o.selected=true;el.appendChild(o)})}function fillTeamOptions(sel,selected=null){const el=document.querySelector(sel);if(!el)return;el.innerHTML='';(state.teams||[]).forEach(t=>{const o=document.createElement('option');o.value=t.id;o.textContent=t.name;if(selected&&selected===t.id)o.selected=true;el.appendChild(o)})}
function renderNotifs(){const tbody=$('#notif-rows');if(!tbody)return;tbody.innerHTML='';const holReqs=state.holidays.map(h=>({createdAt:h.createdAt,type:'holiday',message:`Vakantie ${h.from} ‚Üí ${h.to}`,receiver:'supervisor/manager',status:h.status,id:h.id})),ill=state.notifications.filter(n=>n.type==='illness').map(n=>({createdAt:n.createdAt,type:'illness',message:n.message,receiver:n.toRole,status:'info',id:n.id})),rows=[...holReqs,...ill].sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));rows.forEach(r=>{const tr=document.createElement('tr');const ts=r.createdAt?.seconds?new Date(r.createdAt.seconds*1000):new Date();let actions='';if(r.type==='holiday'&&(state.meRole==='manager'||state.meRole==='supervisor')){actions=`<button class="btn" onclick='approveHoliday("${r.id}")'>Goedkeuren</button><button class="btn" onclick='denyHoliday("${r.id}")'>Afkeuren</button>`}else{actions=`<button class="btn" onclick='removeNotif("${r.id}")'>Verwijderen</button>`}tr.innerHTML=`<td>${ts.toLocaleString()}</td><td>${r.type}</td><td>${r.message}</td><td>${r.receiver||'‚Äî'}</td><td><span class="badge">${r.status}</span></td><td class="actions">${actions}</td>`;tbody.appendChild(tr)});const latest=$('#latest-notifs');latest.innerHTML=state.notifications.slice(0,5).map(n=>`<div>‚Ä¢ ${n.message}</div>`).join('')||'<span class="muted">Geen meldingen‚Ä¶</span>'}async function approveHoliday(id){requireAny('manager','supervisor');await data.holidays.update(id,{status:'approved'})}async function denyHoliday(id){requireAny('manager','supervisor');await data.holidays.update(id,{status:'denied'})}async function removeNotif(id){await data.notifications.delete(id)}async function notifyUpdate(employeeId,message){await data.notifications.create({type:'update',toUserId:employeeId,message})}window.approveHoliday=approveHoliday;window.denyHoliday=denyHoliday;window.removeNotif=removeNotif;
let _map,_layer;function renderMap(){const el=$('#map');if(!el)return;if(!_map){_map=L.map('map').setView([50.85,4.35],7);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap'}).addTo(_map)}if(_layer)_layer.remove();_layer=L.layerGroup().addTo(_map);(state.plants||[]).forEach(p=>{if(!(p.lat&&p.lng))return;const m=L.marker([p.lat,p.lng]).addTo(_layer),k=plantKPIs(p.id);m.bindPopup(`<b>${p.name}</b><br/>Werknemers: ${k.employees}<br/>Zieken: ${k.sick}<br/>Taken toegewezen: ${k.assigned}<br/>Open: ${k.open}<br/>Afgerond: ${k.done}`)});const info=$('#map-info');info.innerHTML=(state.plants||[]).map(p=>{const k=plantKPIs(p.id);return `<div class="kpi"><span class="muted">${p.name}</span><b>${k.assigned}/${k.open+k.done}</b></div>`}).join('')||'<div class="muted">Geen plants.</div>'}function plantKPIs(plantId){const employees=(state.employees||[]).filter(e=>e.plantId===plantId),sick=employees.filter(e=>e.status==='sick').length,tasks=(state.tasks||[]).filter(t=>t.plantId===plantId),assigned=tasks.filter(t=>t.employeeId).length,open=tasks.filter(t=>t.status==='open').length,done=tasks.filter(t=>t.status==='done').length;return{employees:employees.length,sick,assigned,open,done}}
function drawMonthChart(){const el=document.getElementById('chart-month');if(!el)return;const days=[...new Array(30)].map((_,i)=>i+1),donePerDay=days.map(d=>(state.tasks||[]).filter(t=>t.status==='done'&&(t.date||'').split('-')[2]===(String(d).padStart(2,'0'))).length),max=Math.max(1,...donePerDay),w=el.clientWidth||600,h=160,step=w/(days.length-1),pts=donePerDay.map((v,i)=>`${i*step},${h-10-(v/max)*(h-30)}`).join(' ');el.innerHTML=`<svg viewBox="0 0 ${w} ${h}" preserveAspectRatio="none"><polyline fill="none" stroke="#b5121b" stroke-width="2" points="${pts}"></polyline></svg>`}
let unsubscribers=[];function bootSubscriptions(){unsubscribers.forEach(u=>{try{u()}catch{}});unsubscribers=[];const uP=data.subscribe('plants',rows=>{state.plants=rows;renderEmployees();renderTasks();renderMap()}),uE=data.subscribe('employees',rows=>{state.employees=rows;renderEmployees();renderTasks();renderTeams();renderBoard();renderMy();renderMap()}),uT=data.subscribe('tasks',rows=>{state.tasks=rows;renderTasks();renderBoard();renderMy();updateKPIs();renderMap()}),uN=data.subscribe('notifications',rows=>{state.notifications=rows.sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));renderNotifs()}),uG=data.subscribe('teams',rows=>{state.teams=rows;renderTeams();renderBoard()}),uA=data.subscribe('absences',rows=>{state.absences=rows;renderMy()}),uH=data.subscribe('holidays',rows=>{state.holidays=rows;renderNotifs();renderMy()});unsubscribers=[uP||(()=>{}),uE||(()=>{}),uT||(()=>{}),uN||(()=>{}),uG||(()=>{}),uA||(()=>{}),uH||(()=>{})]}
function renderEmployees(){const tbody=$('#emp-rows');if(!tbody)return;tbody.innerHTML='';(state.employees||[]).forEach(e=>{const plant=state.plants.find(p=>p.id===e.plantId),team=state.teams.find(t=>t.id===e.teamId),status=e.status==='sick'?'ziek':e.status==='locked'?'geblokkeerd':'actief',tr=document.createElement('tr');tr.innerHTML=`<td>${e.firstName} ${e.lastName}</td><td>${e.role||'employee'}</td><td>${team?team.name:'‚Äî'}</td><td>${plant?.name||'-'}</td><td><span class="tag">${status}</span></td><td class="actions" data-role="manager"><button class="btn" onclick='editEmployee("${e.id}")'>Bewerken</button><button class="btn" onclick='lockEmployee("${e.id}")'>Lock</button></td>`;tbody.appendChild(tr)});if(!state.employees?.length){tbody.innerHTML=`<tr><td colspan="6" class="muted">Nog geen werknemers‚Ä¶</td></tr>`}}function editEmployee(id){requireRole('manager');const e=state.employees.find(x=>x.id===id);const html=`<div class="row"><div><label>Voornaam</label><input id="e-fn" value="${e.firstName}"/></div><div><label>Achternaam</label><input id="e-ln" value="${e.lastName}"/></div></div><div class="row"><div><label>Rol</label><select id="e-role"><option value="employee">werknemer</option><option value="supervisor">supervisor</option><option value="manager">manager</option></select></div><div><label>Team</label><select id="e-team"></select></div></div><div class="row"><div><label>Plant</label><select id="e-plant"></select></div><div><label>Status</label><select id="e-status"><option value="active">actief</option><option value="locked">geblokkeerd</option><option value="sick">ziek</option></select></div></div><div><label>E-mail</label><input id="e-email" type="email" value="${e.email||''}"/></div>`;ui.open(html,'Werknemer bewerken',async()=>{await data.employees.update(id,{firstName:$('#e-fn').value,lastName:$('#e-ln').value,role:$('#e-role').value,teamId:$('#e-team').value||null,plantId:$('#e-plant').value,status:$('#e-status').value,email:$('#e-email').value.trim()})});fillTeamOptions('#e-team',e.teamId);fillOptions('plants','#e-plant',null,e.plantId);setTimeout(()=>{$('#e-role').value=e.role||'employee';$('#e-status').value=e.status||'active'},0)}async function lockEmployee(id){requireRole('manager');await data.employees.update(id,{status:'locked'})}window.editEmployee=editEmployee;window.lockEmployee=lockEmployee;
async function init(){try{await data.tryCloud()}catch{banner.style.display='block'}bootSubscriptions();state.meRole=rolePicker.value;applyRoleGates();renderTasks();renderTeams();renderBoard();renderMy();renderNotifs();renderMap();drawMonthChart()}$('#retry-btn').onclick=()=>location.reload();$('#local-btn').onclick=()=>data.useLocal();if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init)}else{init()}
